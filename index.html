<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6307423508624576"
     crossorigin="anonymous"></script>
    <title>AQUA MARINE DREAM</title>
    <style>
        /* --- Global Styles --- */
        body {
            font-family: 'MS PGothic', 'ＭＳ Ｐゴシック', sans-serif;
            line-height: 1.6;
            transition: background-color 0.5s ease;
            margin: 0;
            padding: 0;
        }

        .page { display: none; }
        .page.active { display: block; }
        
        a { cursor: pointer; }

        /* --- 共通レイアウト --- */
        .layout-table {
            width: 800px;
            margin: 20px auto;
            border-collapse: collapse;
            transition: all 0.5s ease;
        }
        .header {
            padding: 20px;
            text-align: center;
            transition: background-color 0.5s ease;
        }
        .title-text {
            font-size: 36px;
            font-weight: bold;
            font-family: "Impact", fantasy;
            letter-spacing: 2px;
            transition: all 0.5s ease;
        }
        .menu {
            width: 180px;
            vertical-align: top;
            padding: 15px;
            transition: background-color 0.5s ease;
        }
        .menu h3 {
            padding: 5px;
            font-size: 16px;
            margin-top: 0;
            text-align: center;
            color: white;
            transition: background-color 0.5s ease;
        }
        .menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .menu li {
            padding: 8px 5px;
        }
        .main-content {
            vertical-align: top;
            padding: 20px;
        }
        .diary-entry {
            padding: 15px;
            margin-bottom: 20px;
            transition: all 0.5s ease;
        }
        .diary-title {
            font-weight: bold;
            font-size: 18px;
            padding-bottom: 5px;
            margin-bottom: 10px;
            transition: all 0.5s ease;
        }
        .bbs-post {
            padding: 10px;
            margin-bottom: 10px;
            transition: all 0.5s ease;
        }
        .bbs-meta {
            font-size: 12px;
            border-bottom: 1px dotted #ccc;
            margin-bottom: 5px;
        }
        .footer {
            text-align: center;
            padding: 15px 0;
            font-size: 12px;
        }

        /* --- Normal Mode Styles (Chapter 1) --- */
        body.normal-mode {
            background-color: #cceeff;
            color: #000000;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.7) 12px, transparent 1px);
            background-size: 20px 20px;
        }
        .normal-mode a { color: #0000FF; }
        .normal-mode a:visited { color: #800080; }
        .normal-mode .layout-table {
            border: 2px solid #6699cc;
            background-color: #ffffff;
        }
        .normal-mode .header { background-color: #99ccff; }
        .normal-mode .title-text {
            color: #ffffff;
            text-shadow: 2px 2px 4px #000066;
        }
        .normal-mode .menu { background-color: #e6f3ff; }
        .normal-mode .menu h3 { background-color: #6699cc; }
        .normal-mode .menu li { border-bottom: 1px dashed #6699cc; }
        .normal-mode .main-content h2 { color: #336699; }
        .normal-mode .diary-entry {
            border: 1px solid #99ccff;
            background-color: #f0f8ff;
        }
        .normal-mode .diary-title {
            color: #336699;
            border-bottom: 2px solid #99ccff;
        }
        .normal-mode .bbs-post {
            border: 1px solid #99ccff;
            background: #f0f8ff;
        }
        .normal-mode .counter {
            border: 2px outset gray;
            padding: 2px 5px;
            background: black;
            color: lime;
            font-family: monospace;
            letter-spacing: 2px;
        }
        .normal-mode .footer { color: #888888; }
        

        /* --- Cursed Mode Styles (Chapter 2~) --- */
        body.cursed-mode {
            background-color: #000033;
            color: #cccccc;
            background-image: radial-gradient(circle, rgba(17, 20, 29, 0.8) 12px, transparent 1px);
            background-size: 20px 20px;
        }
        .cursed-mode a { color: #6699ff; }
        .cursed-mode a:visited { color: #9966cc; }
        .cursed-mode .layout-table {
            border-color: #333366;
            background-color: #00001a;
        }
        .cursed-mode .header { background-color: #000022; }
        .cursed-mode .title-text {
            color: #6699cc;
            text-shadow: 0 0 10px #0000ff, 0 0 15px #0000ff;
        }
        .cursed-mode .flickering-text {
            animation: flicker 3s infinite;
        }
        @keyframes flicker {
            0%, 100% { opacity: 1; filter: blur(1px); }
            50% { opacity: 0.7; filter: blur(2px); }
        }
        .cursed-mode .menu { background-color: #00002a; }
        .cursed-mode .menu h3 { background-color: #333366; }
        .cursed-mode .menu li { border-bottom-color: #333366; }
        @keyframes twitch {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(2px, -1px); }
            75% { transform: translate(-1px, 2px); }
        }
        .cursed-mode .main-content #welcome-title {
            font-family: 'MS Mincho', 'Hirino Mincho ProN', serif;
            color: #ffaaaa;
            font-size: 22px;
            line-height: 1.8;
            font-weight: normal;
            text-align: left;
            border-bottom: none;
        }
        .cursed-mode .diary-entry {
            background-color: #000;
            color: #fff;
            border-color: #333;
        }
        .cursed-mode .diary-title {
            color: #ccc;
            border-bottom-color: #555;
        }
        .cursed-mode .bbs-post {
            background-color: #000;
            border-color: #333;
        }
        .cursed-mode .footer { color: #777777; }
        .cursed-mode .hidden-link-area {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 100px;
            height: 100px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24"><path d="M12 2 C5 12, 5 22, 12 22 C19 22, 19 12, 12 2 Z" fill="%2387CEEB"/></svg>'), auto;
            background-image: radial-gradient(circle, rgba(24, 29, 42, 0.6) 1.5px, transparent 1.5px);
            background-size: 25px 25px;
            -webkit-mask-image: radial-gradient(circle, black 40%, transparent 80%);
            mask-image: radial-gradient(circle, black 40%, transparent 80%);
        }
        .cursed-mode .counter {
            border: 2px outset #440000;
            padding: 2px 5px;
            background: #1a0000;
            color: #ff4444;
            font-family: monospace;
            letter-spacing: 2px;
            text-shadow: 0 0 5px #ff0000;
            animation: counter-flicker 2s infinite steps(1);
        }
        @keyframes counter-flicker {
            0%, 100% { opacity: 1; color: #ff4444; }
            50% { opacity: 0.7; color: #cc0000; }
        }
        #tweet-container {
            display: none;
            text-align: left;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }
        .cursed-mode .tweet-button { 
            display: inline-block;
            padding: 10px 20px;
            background-color: #330000;
            border: 1px solid #ff4444;
            color: crimson;
            text-decoration: none;
            font-family: 'MS Mincho', 'Hiragino Mincho ProN', serif;
            box-shadow: 0 0 5px #ff0000;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        .tweet-button:hover {
            background-color: #ff4444;
            color: #000;
            box-shadow: 0 0 15px #ff0000, 0 0 25px #ff0000;
            text-shadow: 0 0 5px #000;
        }

        /* --- Back Diary / Puzzle Styles --- */
        .back-diary-page { background-color: #000; color: #fff; font-family: 'MS Mincho', 'Hirino Mincho ProN', serif; padding: 50px; font-size: 16px; }
        .back-diary-page h2 { text-align: center; font-size: 24px; margin-bottom: 40px; }
        .back-diary-page .entry { margin-bottom: 30px; border-bottom: 1px dotted #555; padding-bottom: 20px; }
        .back-diary-page .entry-title { font-weight: bold; margin-bottom: 10px; }
        .form-container { width: 400px; margin: 50px auto; padding: 30px; border: 1px solid #555; background: #111; text-align: center; }
        .form-container input[type="text"], .form-container input[type="password"] { width: 80%; padding: 8px; margin: 10px 0; background: #333; border: 1px solid #666; color: #fff; }
        .form-container button { padding: 10px 20px; background: #555; border: 1px solid #888; color: #fff; cursor: pointer; }
        .error-message { color: red; margin-top: 10px; min-height: 1em; }
        .file-manager { width: 600px; margin: 50px auto; border: 1px solid #555; background: #111; font-family: monospace; }
        .file-manager-header { background: #333; padding: 10px; font-weight: bold; }
        .file-list { list-style: none; padding: 0; margin: 0; }
        .file-list li { padding: 8px 10px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .file-list li:hover { background: #222; }
        .file-actions button { background: none; border: 1px solid #555; color: #ccc; cursor: pointer; margin-left: 5px; font-size: 12px; }
        #key-content { background: #000; color: #0f0; padding: 20px; margin: 20px; border: 1px solid #0f0; font-family: monospace; }
        
        /* --- Ending Overlay --- */
        #ending-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; opacity: 0; transition: opacity 2s ease-in; pointer-events: none; }


        /* --- Photo Album Styles --- */
        .photo-gallery { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .photo-item { width: 250px; text-align: center; }
        .photo-item .caption { font-size: 12px; margin-bottom: 5px; color: inherit; }
        .photo-item img { width: 100%; height: 180px; object-fit: cover; border: 3px solid #ccc; box-shadow: 3px 3px 6px rgba(0,0,0,0.2); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .photo-item img:hover { transform: scale(1.05); box-shadow: 5px 5px 10px rgba(0,0,0,0.3); }
        .normal-mode .photo-item img { border-color: #99ccff; }
        .cursed-mode .photo-item img { border-color: #333366; }

        /* --- Modal Styles --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); display: none; justify-content: center; align-items: center; z-index: 10000; animation: fadeIn 0.3s ease; }
        .modal-content { position: relative; display: flex; justify-content: center; align-items: center; animation: zoomIn 0.3s ease; }
        .modal-content img { display: block; height: 90vh; width: auto; max-width: 90vw; }
        .close-button { position: absolute; top: -40px; right: 0; color: #fff; font-size: 40px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .close-button:hover { color: #bbb; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.8); } to { transform: scale(1); } }
        
        #marquee-container {
            padding: 4px;
            margin-bottom: 15px;
            transition: all 0.5s ease;
        }
        .normal-mode #marquee-container {
            border: 2px outset #6699cc;
            background: linear-gradient(to bottom, #d0eaff, #ffffff);
        }
        .cursed-mode #marquee-container {
            border-style: inset;
            border-color: #333366;
            background: #000;
        }
        #marquee-welcome {
            height: 80px;
            padding: 5px;
            font-weight: bold;
        }
        .normal-mode #marquee-welcome {
            color: #003366;
            text-shadow: 1px 1px 0px #fff;
        }
        .cursed-mode #marquee-welcome {
            color: #6699cc;
            text-shadow: 0 0 5px #0000ff;
            font-weight: normal;
            height: auto;
            padding: 10px 5px;
        }
    </style>
</head>
<body class="normal-mode">

    <div id="page-container">
        <!-- Main site pages -->
        <div id="top" class="page active">
            <table class="layout-table" border="0" cellpadding="0">
                <tr>
                    <td colspan="2" class="header">
                        <h1 class="title-text">
                            <img src="dolphin0.gif" alt="dolphin" class="dolphin" height="80">
                            <span class="flickering-text">AQUA MARINE DREAM</span>
                            <img src="dolphin0.gif" alt="dolphin" class="dolphin" height="80" style="transform: scaleX(-1);">
                        </h1>
                    </td>
                </tr>
                <tr>
                    <td class="menu">
                        <h3>MENU</h3>
                        <div id="marquee-container">
                            <marquee id="marquee-welcome" behavior="scroll" direction="up" scrollamount="2">Welcome to AQUA MARINE DREAM!</marquee>
                        </div>
                        <ul>
                            <li><a href="javascript:void(0);" onclick="showPage('top')">TOP</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('diary')">Diary</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('photo')">Photo</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('bbs')">BBS</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('link')">Link</a></li>
                        </ul>
                        <hr>
                        <p>You are <span id="counter" class="counter">000048</span>th visitor!</p>
                    </td>
                    <td class="main-content">
                        <h2 id="welcome-title">ようこそ！</h2>
                        <p id="welcome-text">ここは管理人AQUAの気まぐれホームページです☆<br>日記をメインに、のんびり更新していきます。<br>ゆっくりしていってね！</p>
                        
                        <div id="tweet-container">
                            <a href="javascript:void(0);" onclick="tweetCurse()" class="tweet-button">
                                呪いを拡散する
                            </a>
                        </div>

                        <p id="welcome-text-2">キリ番踏んだ方はぜひBBSに書き込んでください♪</p>
                        <hr id="welcome-hr">
                        <p id="welcome-update"><strong>Last Update: 2003/10/28</strong></p>
                        <div class="hidden-link-area" onclick="showBackDiary()"></div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="footer">
                        [Powered by <a href="javascript:void(0);" onclick="showPuzzle('admin-login')">ホームページ・工房</a>]
                    </td>
                </tr>
            </table>
        </div>
        
        <!-- Other Pages (Diary, Photo, etc.) -->
        <div id="diary" class="page">
            <table class="layout-table" border="0" cellpadding="0">
                <tr><td colspan="2" class="header"><h1 class="title-text">Diary</h1></td></tr>
                <tr>
                    <td class="menu">
                        <h3>MENU</h3>
                        <ul>
                            <li><a href="javascript:void(0);" class="link-to-top" onclick="handleTopLinkClick()">TOPへ</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('diary')">Diary</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('photo')">Photo</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('bbs')">BBS</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('link')">Link</a></li>
                        </ul>
                    </td>
                    <td class="main-content">
                        <!-- Diary Entries -->
                        <div class="diary-entry"><h3 class="diary-title">【2002/04/15】 高校生活！</h3><p>ついに高校生！ 制服が可愛くてテンション上がる↑↑ 友達100人できるかな？ これから始まる高校生活、楽しみすぎるっ！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/06/05】 体育祭！</h3><p>体育祭だったよー！ 私たちのクラスはリレーで優勝！ みんなで円陣組んで泣いちゃった。青春って感じ！ 最高の思い出がまた増えた！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/06/12】 ドキドキが止まらないっ＞＜</h3><p>信じられないことが起きちゃった…！ なんと、サッカー部のキャプテンの翔太君から告白されちゃったんですっ！ 「ずっと好きでした。付き合ってください」だって…！ もう、心臓が飛び出るかと思った！ もちろん答えは…まだ内緒（笑） どうしよう、嬉しすぎて今夜は眠れないかもっ！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/07/25】 海だー！</h3><p>今日はみんなで海！ 新しい水着、ユミに「似合うじゃん」って褒められちゃった♪ 日焼け止め塗ったのにちょっと焼けちゃったかも＞＜ でも夏って感じでいっか！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/08/01】 夏祭り！</h3><p>地元の夏祭りに行ってきたよ！ みんなで浴衣着て、りんご飴食べて、射的やって…♪ 翔太君にも会えちゃったし、ラッキー☆</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/08/14】 夏休み最高！</h3><p>今日は親友のユミとミカと原宿にショッピング♪ 竹下通りでクレープ食べて、最新のコスメをいっぱいゲット！ プリクラも撮ったよ☆ 目が大きく写るやつ、マジすごい！ 夜はみんなで花火したんだ。線香花火、誰が一番長く持つか競争したの。夏休みって、本当に最高の思い出ばっかり！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/09/15】 翔太君と初デート！？</h3><p>この前の日曜日、翔太君と偶然会って、一緒にお茶したんだ！マジ緊張したけど、すっごく楽しかった！これってデートって言ってもいいのかな？（笑）応援してくれたユミとミカに感謝！二人には後で詳しく報告しなきゃ♪</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/10/25】 文化祭、大成功！</h3><p>３日間の文化祭、ついに終わっちゃった…！ 私たちのクラスの出し物はカフェだったんだけど、すっごく大盛況だったんだよ！ 私は実行委員で準備とか大変だったけど、クラスのみんなが「AQUAのおかげだよ」って言ってくれて、本当に嬉しかった（；＿；） 打ち上げもめちゃくちゃ盛り上がったし、最高の思い出がまた一つ増えちゃったな♪</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2002/12/24】 メリクリ☆</h3><p>今日はクリスマスイブ！ みんなで集まってクリスマスパーティーしたよ！<br>プレゼント交換もしたんだ♪ 私はユミがくれた可愛いマフラーが当たったの！<br>チキンとケーキも美味しかったし、超楽しかった～！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/02/14】 Happy Valentine!</h3><p>今日はバレンタイン！翔太君に手作りチョコ、渡せたよ～！すっごいドキドキしたけど、「ありがとう」って笑ってくれて嬉しかったな。放課後はユミたちとチョコ交換会！友チョコもいっぱいもらっちゃった☆</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/04/07】 ２年生！</h3><p>ついに２年生になっちゃった！ クラス替え、ドキドキしたけど、仲良い子とまた同じクラスになれたよ！<br>新しい後輩も入ってくるし、先輩としてしっかりしなきゃね！ 今年も最高の１年にするぞー！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/07/01】 期末テストおつかれ会！</h3><p>やっとテスト終わったー！解放感ハンパない！ってことで、今日はみんなでカラオケ♪ ストレス発散できたし、マジ最高だった！夏休み、何しよっかなーって計画立てるだけでワクワクする！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/07/28】 補習だるい…</h3><p>まさかの補習に呼ばれちゃった＞＜<br>夏休みなのに学校とか、マジありえない…。でも、翔太君も同じクラスでちょっとラッキーかも（笑）<br>早く終わらせて遊びたーい！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/08/20】 親友と旅行♪</h3><p>ユミとミカとプチ旅行に行ってきたよ！<br>温泉に入って、美味しいものいっぱい食べて、夜通しガールズトーク！<br>マジで最高の思い出になった！ ２人とも、本当に大好き！ 一生モノの親友だよっ！</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/09/02】 始業式と、ちょっとしたトラブル</h3><p>二学期スタート！夏休み明けでみんなに会えるの嬉しいな。…って思ったけど、朝からユミとミカがちょっとケンカしてたみたい。心配だったけど、放課後には仲直りしてたから一安心！私たち、何でも話し合えるもんね！これからもずっと一緒だよ。</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/09/10】 新学期スタート！</h3><p>長かった夏休みも終わり！ みんなに会えるのは嬉しいけど、宿題が終わってなくて焦った～（笑）<br>文化祭の準備も始まるし、２学期も楽しいこといっぱいだといいな♪</p></div>
                        <div class="diary-entry"><h3 class="diary-title">【2003/10/28】 最近…</h3><p>もうすっかり秋だね～。なんだか最近、ちょっと疲れ気味かも…。<br>勉強も部活も、ちょっとだけお休みしたい気分。<br>でも、ここで頑張らないとだよね！ みんなも頑張ってるし！<br>よし、明日からも気合入れていくぞー！</p></div>
                        <!-- End Diary Entries -->
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="footer">
                        [Powered by <a href="javascript:void(0);" onclick="showPuzzle('admin-login')">ホームページ・工房</a>]
                    </td>
                </tr>
            </table>
        </div>
        <div id="photo" class="page">
             <table class="layout-table" border="0" cellpadding="0">
                <tr><td colspan="2" class="header"><h1 class="title-text">Photo</h1></td></tr>
                <tr>
                    <td class="menu">
                        <h3>MENU</h3>
                        <ul>
                             <li><a href="javascript:void(0);" class="link-to-top" onclick="handleTopLinkClick()">TOPへ</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('diary')">Diary</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('photo')">Photo</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('bbs')">BBS</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('link')">Link</a></li>
                        </ul>
                    </td>
                    <td class="main-content">
                        <h2>Photo Album</h2>
                        <h3>思い出を少しだけおすそわけ♪</h3>
                        <div id="photo-content" class="photo-gallery">
                            <div class="photo-item" id="photo-1">
                                <p class="caption">これからどんな高校生活が待ってるのかな？ (2002/04/08)</p>
                                <img src="nyugaku.png" alt="入学式">
                            </div>
                            <div class="photo-item" id="photo-2">
                                <p class="caption">線香花火楽しかったな〜 (2002/08/14)</p>
                                <img src="hanabi.png" alt="線香花火">
                            </div>
                            <div class="photo-item" id="photo-3">
                                <p class="caption">夏祭り♪ 翔太君が買ってくれたりんご飴！ (2002/08/01)</p>
                                <img src="ringoame.png" alt="夏祭りのりんご飴">
                            </div>
                            <div class="photo-item" id="photo-4">
                                <p class="caption">ユミ＆ミカとクリスマス☆ (2002/12/24)</p>
                                <img src="kurisumasu.png" alt="クリスマス">
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="footer">
                        [Powered by <a href="javascript:void(0);" onclick="showPuzzle('admin-login')">ホームページ・工房</a>]
                    </td>
                </tr>
            </table>
        </div>
        <div id="bbs" class="page">
            <table class="layout-table" border="0" cellpadding="0">
                <tr><td colspan="2" class="header"><h1 class="title-text">BBS</h1></td></tr>
                <tr>
                    <td class="menu">
                        <h3>MENU</h3>
                        <ul>
                             <li><a href="javascript:void(0);" class="link-to-top" onclick="handleTopLinkClick()">TOPへ</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('diary')">Diary</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('photo')">Photo</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('bbs')">BBS</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('link')">Link</a></li>
                        </ul>
                    </td>
                    <td class="main-content">
                        <div id="bbs-posts"><div class="bbs-post"><div class="bbs-meta">1: <b>AQUA</b> [2002/04/14] IP: 03.0.113.1</div><div class="bbs-body">掲示板つくりました！ みんな書き込んでね♪</div></div><div class="bbs-post"><div class="bbs-meta">2: <b>名無しさん</b> [2002/06/23] IP: 03.0.113.1</div><div class="bbs-body">いつも見てます！ 充実した高校生活うらやましいです！</div></div><div class="bbs-post"><div class="bbs-meta">3: <b>AQUA</b> [2002/06/23] IP: 03.0.113.1</div><div class="bbs-body">＞２さん<br>ありがとうございます！ これからもたくさん更新しますね☆</div></div></div>
                        <div id="bbs-form-container" style="display: none;"></div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="footer">
                        [Powered by <a href="javascript:void(0);" onclick="showPuzzle('admin-login')">ホームページ・工房</a>]
                    </td>
                </tr>
            </table>
        </div>
        <div id="link" class="page">
             <table class="layout-table" border="0" cellpadding="0">
                <tr><td colspan="2" class="header"><h1 class="title-text">Link</h1></td></tr>
                <tr>
                    <td class="menu">
                        <h3>MENU</h3>
                        <ul>
                             <li><a href="javascript:void(0);" class="link-to-top" onclick="handleTopLinkClick()">TOPへ</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('diary')">Diary</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('photo')">Photo</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('bbs')">BBS</a></li>
                            <li><a href="javascript:void(0);" onclick="showPage('link')">Link</a></li>
                        </ul>
                    </td><td class="main-content"><h2>準備中...</h2></td>
                </tr>
                <tr>
                    <td colspan="2" class="footer">
                        [Powered by <a href="javascript:void(0);" onclick="showPuzzle('admin-login')">ホームページ・工房</a>]
                    </td>
                </tr>
            </table>
        </div>
        
        <!-- Puzzle pages container -->
        <div id="back-diary" class="page back-diary-page"></div>
        <div id="password-form" class="page back-diary-page"></div>
        <div id="letter" class="page back-diary-page"></div>
        <div id="admin-login" class="page back-diary-page"></div>
        <div id="secret-question" class="page back-diary-page"></div>
        <div id="file-manager" class="page back-diary-page"></div>
    </div>
    
    <div id="ending-overlay"></div>

    <!-- Modal for Photos -->
    <div id="modal-overlay" class="modal-overlay">
        <div id="modal-content" class="modal-content">
            <span id="close-button" class="close-button">&times;</span>
            <img id="modal-image" src="" alt="拡大画像">
        </div>
    </div>


    <script>
        // --- State and Elements ---
        const STATE = {
            mode: 'normal',
            puzzles_unlocked: {
                secret_question: false,
                letter: false,
            },
            endingTriggered: false
        };
        const pages = document.querySelectorAll('.page');
        const bodyEl = document.body;
        let curseSpreadClicked = false;
        let adminLoginReturnPage = 'top';

        // --- Page Navigation ---
        function showPage(pageId) {
            if (!document.getElementById(pageId)) return;
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        // --- Story Triggers ---
        function handleTopLinkClick() {
            if (STATE.mode === 'normal') {
                triggerCurse();
            } else {
                showPage('top');
            }
        }
        
        function triggerCurse() {
            STATE.mode = 'cursed';
            document.querySelectorAll('.dolphin').forEach(img => {
                img.src = 'dolphin1.gif'; 
            });
            const pageContainer = document.getElementById('page-container');
            pageContainer.style.transition = 'opacity 0.5s';
            pageContainer.style.opacity = '0';
            
            setTimeout(() => {
                bodyEl.className = 'cursed-mode';
                showPage('top');

                const marqueeContainer = document.getElementById('marquee-container');
                if (marqueeContainer) {
                    // 新しいmarquee要素のHTML文字列を作成
                    const newMarqueeHTML = `
                        <marquee id="marquee-welcome" behavior="scroll" direction="left" scrollamount="2">
                            繧｢繧ｯ繧｢繝槭Μ繝ｳ縺ｮ螟｢
                        </marquee>
                    `;
                    // コンテナの中身を丸ごと入れ替える
                    marqueeContainer.innerHTML = newMarqueeHTML;
                }
                
                document.getElementById('welcome-text').style.display = 'none';
                document.getElementById('welcome-text-2').style.display = 'none';
                document.getElementById('welcome-hr').style.display = 'none';
                document.getElementById('welcome-update').style.display = 'none';

                const welcomeTitle = document.getElementById('welcome-title');
                
                typeCurseMessage(welcomeTitle, () => {
                    const tweetContainer = document.getElementById('tweet-container');
                    tweetContainer.style.display = 'block';
                    setTimeout(() => {
                        tweetContainer.style.opacity = 1;
                    }, 10);
                });

                window.onbeforeunload = () => " ";
                
                pageContainer.style.opacity = '1';
            }, 500);
        }

        function typeCurseMessage(targetElement, onComplete) {
            if (!targetElement) return;
            const messages = ["見つけてくれて、ありがとう。", "今日が終わるまでに、誰かにここを教えてあげてね。", "できなければ、", "あなたは一生海の底。"];
            targetElement.innerHTML = '';
            let messageIndex = 0, charIndex = 0;
            function type() {
                if (messageIndex >= messages.length) {
                    if (onComplete) onComplete();
                    return;
                }
                if (charIndex < messages[messageIndex].length) {
                    targetElement.innerHTML += messages[messageIndex].charAt(charIndex++);
                    setTimeout(type, 100);
                } else {
                    targetElement.innerHTML += '<br>';
                    messageIndex++; charIndex = 0;
                    setTimeout(type, 500);
                }
            }
            type();
        }

        function tweetCurse() {
            curseSpreadClicked = true;
            const tweetText = "この海の底で、君を待ってる… #AQUAMARINEDREAM";
            const tweetUrl = "https://aqua-marine-dream.example.com"; 
            const twitterIntentUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}&url=${encodeURIComponent(tweetUrl)}`;
            window.open(twitterIntentUrl, '_blank');
        }

        function triggerBadEnd() {
            const tweetContainer = document.getElementById('tweet-container');
            tweetContainer.style.transition = 'opacity 0.5s ease';
            tweetContainer.style.opacity = '0';
            setTimeout(() => {
                tweetContainer.style.display = 'none';
            }, 500);

            const welcomeTitle = document.getElementById('welcome-title');
            
            const badEndMessages = [
                "おめでとう。",
                "あなたの呪いは解けたよ。",
                "そのかわり、新しい誰かがここへやってくる。",
                "ありがとう。",
                "", 
                "さようなら。"
            ];
            
            welcomeTitle.innerHTML = '';
            let messageIndex = 0;
            let charIndex = 0;
            
            function type() {
                if (messageIndex >= badEndMessages.length) return;
                
                const currentLine = badEndMessages[messageIndex];
                
                if (charIndex < currentLine.length) {
                    welcomeTitle.innerHTML += currentLine.charAt(charIndex++);
                    setTimeout(type, 100);
                } else {
                    welcomeTitle.innerHTML += '<br>';
                    messageIndex++;
                    charIndex = 0;
                    setTimeout(type, 700);
                }
            }
            
            setTimeout(type, 1000);
        }

        function showBackDiary() {
            if (STATE.mode !== 'cursed') return;
            document.getElementById('back-diary').innerHTML = `<div style="text-align: right; padding: 10px 20px 0; font-family: 'MS PGothic', sans-serif;">
                    <a href="javascript:void(0);" onclick="showPage('top');">[ホームページに戻る]</a>
                </div>
                <h2>本当の日記</h2>
                <div class="entry"><p class="entry-title">【2002/04/08】</p><p>高校生になった。誰も私のことなんて知らない。ここでなら、やり直せるかもしれないと思った。<br>でも、周りの子たちはみんなキラキラして見えて、話しかける勇気なんてなかった。初日から、ひとりだった。</p></div>
                <div class="entry"><p class="entry-title">【2002/04/14】</p><p>ホームページを作った。<br>明るくて、友達がたくさんいて、毎日が楽しくて仕方ない、そんな女の子「AQUA」のホームページ。<br>本当のわたしとは、全然違う。<br>でも、それでいい。誰も見てくれなくてもいい。インターネットの海のどこかに、理想のわたしが生きていられる場所がある。それだけで、少しだけ息ができる気がした。</p></div>
                <div class="entry"><p class="entry-title">【2002/06/12】</p><p>今日、クラスの男子に告白された。罰ゲームだった。<br>サッカー部の翔太が、みんなの前で「好きです」って言った。一瞬、本当かと思った自分が馬鹿みたいだった。わたしが何か言う前に、周りで見ていたユミとミカが笑い出した。クラス中が笑っていた。<br>わたしは、ただそこに立っていることしかできなかった。<br><br>夜、日記を書いた。<br>嘘ばっかり。本当は、悔しくて、恥ずかしくて、涙が止まらなかった。<br>でも、そうしないと、心が壊れてしまいそうだった。</p></div>
                <div class="entry"><p class="entry-title">【2002/08/13】</p><p>今日はおばあちゃんの家に行った。おばあちゃんが、昔使っていたという綺麗な指輪をくれた。<br>『これはね、お守りだから。辛いことがあったら、これを見てごらん。きっと力をくれるから』って。<br>銀色で、小さな青い石がついている。太陽の光にかざすと、キラキラして、海の底みたいに綺麗。<br>わたしの、たった一つの宝物になった。</p></div>
                <div class="entry"><p class="entry-title">【2002/09/15】</p><p>惨め。<br>日曜日、一人で図書館に行った帰り、翔太がユミとミカと一緒にいるのを見た。楽しそうに笑ってた。わたしが罰ゲームで告白された時の話をしていた。わたしのことを見て、クスクス笑っていた。目が合ったのに、すぐに逸らされた。</p></div>
                <div class="entry"><p class="entry-title">【2002/10/25】</p><p>文化祭が終わった。<br>実行委員の仕事は、ほとんどわたしが一人でやった。買い出しも、ポスター作りも、シフトの調整も。誰も手伝ってくれなかった。「そういうの得意でしょ？」って、全部押し付けられた。<br>カフェが成功したのは、わたしのおかげじゃない。みんなが楽しそうだっただけ。<br>打ち上げにも呼ばれなかった。教室で一人で片付けをしていたら、廊下からみんなの笑い声が聞こえた。</p></div>
                <div class="entry"><p class="entry-title">【2003/02/14】</p><p>ゴミ箱の中のチョコレート。<br>ユミとミユに命令されて、翔太の下駄箱に手紙付きのチョコレートを入れた。でも、放課後、掃除当番でゴミを捨てに行ったら、それが見覚えのある包みのまま、ゴミ箱に捨てられていた。涙も出なかった。</p></div>
                <div class="entry"><p class="entry-title">【2003/04/07】</p><p>二年生になった。クラス替えがあったけど、何も変わらなかった。<br>誰もわたしに話しかけない。わたしも誰にも話しかけられない。新しい教室でも、わたしの席だけ空気が違う。</p></div>
                <div class="entry"><p class="entry-title">【2003/07/01】</p><p>聞こえないふり。<br>テストが終わった。教室で、ユミたちが『この後カラオケ行こー！』って話しているのが聞こえた。誰もわたしを誘わない。わたしがいないみたいに、話が進んでいく。聞こえないふりをして、一人で帰った。<br>AQUAは、みんなとカラオケに行った。楽しかったって。よかったね、AQUA。</p></div>
                <div class="entry"><p class="entry-title">【2003/08/25】</p><p>夏休みが終わる。結局、誰からも連絡は来なかった。<br><br>わたしが泣いている時も、AQUAは笑って日記を書いてくれる。<br>わたしが誰とも話せない日も、AQUAは友達との思い出を語ってくれる。<br>彼女だけが、わたしの本当の気持ちを全部受け止めて、輝いてくれる。<br>わたしの、たった一人の光。<br><br>もう疲れた。嘘をつくのも、期待するのも。</p></div>
                <div class="entry"><p class="entry-title">【2003/09/02】</p><p>朝、教室の隅でユミとミカが口論していたのが聞こえた。<br><br>わたしの「処分」について、話し合っていた。<br><br>放課後、二人は笑いながらわたしの席に近づいてきた。<br>仲直りしたんだ、と思った。<br><br>ユミが言った。<br>『あれー？ミカ、この席って誰か座ってたっけ？』<br>ミカはわたしを真っ直ぐ見ながら、答えた。<br>『ううん？最初からずっと空席だよ』<br><br>そう言って、ユミは当たり前のようにわたしの机にカバンを置いた。<br><br>喧嘩のあとの仲直りは、もっと残酷な遊びを見つけることだったんだ。<br><br>私はもう、ただの、「空席」。</p></div>
                <div class="entry"><p class="entry-title">【2003/09/03】</p><p>今日、おばあちゃんが、天国に旅立った。<br>たった一人の、わたしの味方だったのに。もう、あの優しい声も聞けない。頭を撫でてくれる温かい手も、もうない。<br>指輪を握りしめても、もう力なんて湧いてこない。ただ冷たいだけ。<br>心の支えが、音を立てて崩れていく。真っ暗な海の底に、一人で沈んでいくみたい。<br>もう、何も見えない。何も感じない。</p></div>
                <div class="entry"><p class="entry-title">【2003/09/10】</p><p>最後の電話。<br>おばあちゃんが亡くなる三日前、電話で話したのが最後だった。『湊（みなと）、元気でやってるかい』って聞かれて、わたし、嘘をついた。『うん、友達もたくさんできて、毎日すごく楽しいよ』って。心配かけたくなかった。でも、本当は助けてほしかった。『辛い』って、ただ一言言えばよかった。<br>ごめんなさい、おばあちゃん。わたし、最後まで嘘つきだったね。</p></div>
                <div class="entry"><p class="entry-title">【2003/09/15】</p><p>見つけた。<br>古い雑誌に載っていた。「呪いの儀式」。<br>ホームページを使って、呪いをかける方法。<br>サイトに特別な呪文を埋め込んで、訪問者の意識を捕らえる。<br>わたしのホームページは、そのための完璧な舞台になる。<br>キラキラした、誰もが羨むような毎日。あの嘘の日記は、呪いを増幅させるための最高の「餌」になる。<br>あのページを見た人は、きっと少しだけ、羨ましいって思うはず。妬ましいって思うはず。その黒い感情が、呪いの動力源になる。<br><br>あの世界を覗き見た魂を、わたしが作った深海に引きずり込む。<br>呪いから逃れる術は、他の誰かを犠牲にすることだけ。</p></div>
                <div class="entry"><p class="entry-title">【2003/10/10】</p><p>もうすぐ準備が終わる。<br>これで、わたしはもう一人じゃない。<br>たくさんの人が、わたしと一緒にこの冷たい海の底に沈んでくれる。<br>嬉しいな。すごく、嬉しい。</p></div>
                <div class="entry"><p class="entry-title">【2003/10/28】</p><p>完成した。<br>なんだか、疲れた。<br>考えるのも、息をするのも。<br><br>おやすみなさい。</p></div>
                <div class="entry"><p class="entry-title">【2003/11/15】</p><p><a href="javascript:void(0);" onclick="showPuzzle('password-form')"> This diary is protected </a></p></div>
                <p style="text-align:center; margin-top: 40px;">[Powered by <a href="javascript:void(0);" onclick="showPuzzle('admin-login')">ホームページ・工房</a>]</p>`;
            showPage('back-diary');
        }
        
        function showPuzzle(pageId) {
            if (pageId === 'admin-login') {
                const currentPage = document.querySelector('.page.active');
                if (currentPage && currentPage.id !== 'secret-question') {
                    adminLoginReturnPage = currentPage.id;
                }
            }
            const puzzleHTML = {
                'password-form': `<div class="form-container"><h2>Protected Diary</h2><p>ヒント：わたしの一番の宝物</p><form onsubmit="checkSecretDiaryPassword(event)"><input type="text" id="secret-password" placeholder="パスワードを入力"><button type="submit">開く</button><p id="error-message-secret" class="error-message"></p></form><a href="javascript:void(0);" onclick="showPage('back-diary')">戻る</a></div>`,
                'admin-login': `<div class="form-container"><h2>管理者ログイン</h2><form onsubmit="checkAdminLogin(event)"><input type="text" id="admin-id" placeholder="ID"><p id="error-message-admin-id" class="error-message"></p><input type="text" id="admin-pass" placeholder="Password"><p id="error-message-admin-pass" class="error-message"></p><button type="submit">ログイン</button><p id="error-message-admin" class="error-message"></p></form><a href="javascript:void(0);" onclick="showPuzzle('secret-question')">パスワードをお忘れの方はこちら</a><br><a href="javascript:void(0);" onclick="showPage(adminLoginReturnPage || 'top')">戻る</a></div>`,
                'secret-question': `<div class="form-container"><h2>秘密の質問</h2><p>あなたの、たった一人の「親友」の名前は？</p><form onsubmit="checkSecretQuestion(event)"><input type="text" id="secret-answer" placeholder="答えを入力"><button type="submit">送信</button><p id="error-message-question" class="error-message"></p></form><a href="javascript:void(0);" onclick="showPuzzle('admin-login')">戻る</a></div>`,
                'file-manager': `<div class="file-manager">
                    <div class="file-manager-header">/public_html/</div>
                    <ul class="file-list">
                        <li><span>index.html</span><div class="file-actions"><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                        <li><span>diary.html</span><div class="file-actions"><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                        <li><span>bbs.cgi</span><div class="file-actions"><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                        <li><span>photo.html</span><div class="file-actions"><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                        <li><span>link.html</span><div class="file-actions"><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                        <li><span>noroi.js</span><div class="file-actions"><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                        <li><span>key.txt</span><div class="file-actions"><button onclick="document.getElementById('key-content').style.display='block'">開く</button><button onclick="alert('エラー：このファイルは保護されています。削除できません。')">削除</button></div></li>
                    </ul>
                    <div id="key-content" style="display:none;">「わたしの一番の宝物は、おばあちゃんがくれたお守りの中に」</div>
                    <a href="javascript:void(0);" onclick="showPage('back-diary')" style="display:block; text-align:center; padding:10px;">戻る</a>
                </div>`
            };
            
            if(puzzleHTML[pageId]) { 
                const pageElement = document.getElementById(pageId);
                if (pageElement) {
                    pageElement.innerHTML = puzzleHTML[pageId];
                }
            }
            
            // 管理者ログインフォームが表示された場合、入力値の検証イベントを設定
            if (pageId === 'admin-login') {
                const adminIdInput = document.getElementById('admin-id');
                const adminPassInput = document.getElementById('admin-pass');
                const errorIdEl = document.getElementById('error-message-admin-id');
                const errorPassEl = document.getElementById('error-message-admin-pass');

                const validateAndWarn = (inputEl, errorEl) => {
                    if (/[^a-zA-Z0-9]/.test(inputEl.value)) {
                        errorEl.textContent = '半角英数字で入力してください。';
                    } else {
                        errorEl.textContent = '';
                    }
                };
                
                if (adminIdInput && errorIdEl) {
                    adminIdInput.addEventListener('input', () => validateAndWarn(adminIdInput, errorIdEl));
                }
                if (adminPassInput && errorPassEl) {
                    adminPassInput.addEventListener('input', () => validateAndWarn(adminPassInput, errorPassEl));
                }
            }

            showPage(pageId);
        }

        function checkAdminLogin(event) {
            event.preventDefault();
            const idInput = document.getElementById('admin-id');
            const passInput = document.getElementById('admin-pass');
            const idValue = idInput.value;
            const passValue = passInput.value;
            const errorIdEl = document.getElementById('error-message-admin-id');
            const errorPassEl = document.getElementById('error-message-admin-pass');
            const generalErrorEl = document.getElementById('error-message-admin');

            // エラーメッセージをリセット
            errorIdEl.textContent = '';
            errorPassEl.textContent = '';
            generalErrorEl.textContent = '';

            let isValid = true;

            // IDのバリデーション
            if (/[^a-zA-Z0-9]/.test(idValue)) {
                errorIdEl.textContent = '半角英数字で入力してください。';
                isValid = false;
            }

            // パスワードのバリデーション
            if (/[^a-zA-Z0-9]/.test(passValue)) {
                errorPassEl.textContent = '半角英数字で入力してください。';
                isValid = false;
            }

            // バリデーションエラーがあれば処理を中断
            if (!isValid) {
                return;
            }

            // ログイン情報のチェック
            if (idValue.toLowerCase() === 'minato' && passValue === '1028' && STATE.puzzles_unlocked.secret_question) {
                showPuzzle('file-manager');
            } else {
                generalErrorEl.textContent = 'IDまたはパスワードが違います。';
            }
        }
        function checkSecretQuestion(event) { event.preventDefault(); if (document.getElementById('secret-answer').value.toUpperCase() === 'AQUA') { STATE.puzzles_unlocked.secret_question = true; alert("パスワードをリセットしました。新しいパスワードは『1028』です。"); showPuzzle('admin-login'); } else { document.getElementById('error-message-question').textContent = '答えが違います。'; } }
        function checkSecretDiaryPassword(event) {
            event.preventDefault();
            if (document.getElementById('secret-password').value.toUpperCase() === 'YUBIWA') {
                STATE.puzzles_unlocked.letter = true;
                document.getElementById('letter').innerHTML = `<h2>【日付不明】</h2><p>これは、本当の日記でも、嘘の日記でもない。<br>わたしが、もしも誰かにこの場所を見つけてほしかったら、って思った時のための、手紙。</p><p>このサイトは、わたしの憎しみでできてる。<br>でも、全部が憎しみだったわけじゃないんだよ。</p><p>おばあちゃんがくれた指輪。辛い時、いつもそれを握りしめてた。<br>太陽の光にかざすと、小さな青い石がキラキラして、まるで海の底みたいだったの。<br>『これがお守りだから』って言ってくれたおばあちゃんの言葉だけが、わたしの支えだった。</p><p>もし、この手紙を読んでいる人がいたら、お願いがあります。</p><p>わたしの呪いは、わたしの孤独と憎しみから生まれてる。<br>だから、誰かに移しても、呪いはどんどん大きく、強くなるだけ。<br>憎しみは、憎しみしか生まないから。</p><p>呪いを消す方法は、たった一つ。</p><p>わたしの作った、この空っぽの水槽に、何か一つでもいい。温かい言葉を、注いでください。</p><p>そうすれば、わたしの憎しみで満たされたこの海は、きっと、少しだけ温かくなるから。<br>そして、わたしも、やっと眠れるから。</p>
                <p style="text-align:center; margin-top: 40px;">
                    <a href="javascript:void(0);" onclick="goToBbsForEnding()">[ BBSへ行く ]</a>
                    <br><br>
                    <a href="javascript:void(0);" onclick="showPage('top');">[ホームページに戻る]</a>
                </p>`;
                showPage('letter');
            } else { document.getElementById('error-message-secret').textContent = 'パスワードが違います。'; }
        }
        
        function goToBbsForEnding() {
            if (STATE.endingTriggered) {
                showPage('bbs');
                return;
            }
            showPage('bbs');
            document.getElementById('bbs-form-container').innerHTML = `
                <hr>
                <p style="font-size: 14px; margin-bottom: 15px; text-align: center;">
                    彼女に優しい言葉をかけて人の優しさを教えてあげてください。
                </p>
                <form onsubmit="handleBbsSubmit(event)" style="text-align: center;">
                    <p>ハンドルネーム: <input type="text" id="bbs-name" placeholder="" size="20"></p>
                    <textarea id="bbs-message" rows="2" cols="50" style="margin: 0 auto 10px;"></textarea><br>
                    <button type="submit">書き込む</button>
                    <p id="bbs-error" class="error-message"></p>
                </form>`;
            document.getElementById('bbs-form-container').style.display = 'block';
        }

        function handleBbsSubmit(event) {
            event.preventDefault();
            if (!STATE.puzzles_unlocked.letter || STATE.endingTriggered) return;

            const name = document.getElementById('bbs-name').value;
            const message = document.getElementById('bbs-message').value.trim();
            const errorEl = document.getElementById('bbs-error');
            errorEl.textContent = ''; 

            if (message === '') {
                errorEl.textContent = 'メッセージを入力してください。';
                return;
            }
            
            const allowedKeywordPairs = [
                ['一人', 'じゃない'], ['1人', 'じゃない'], ['１人', 'じゃない'], ['ひとり', 'じゃない'], ['ここに', 'いるよ'], ['そばに', 'いるよ'], ['手を', '繋いで'], ['君の', '居場所'], ['独り', '終わり'], ['声', '届い'], ['君の', '味方'], ['私', '探して'], ['頑張っ', 'ありがとう'], ['がんばっ', 'ありがとう'], ['生まれ', 'ありがとう'], ['うまれ', 'ありがとう'], ['見つけ', 'ありがとう'], ['みつけ', 'ありがとう'], ['君の', '名前'], ['生きて', '証'], ['存在', '光'], ['ありのまま', '素敵'], ['物語', 'ありがとう'], ['君が', 'いたから'], ['心から', '感謝'], ['気持ち', 'ありがとう'], ['海', '光'], ['温かい', '夢'], ['温かい', 'ゆめ'], ['あたたかい', '夢'], ['あたたかい', 'ゆめ'], ['朝日', '一緒'], ['夜が', '明け'], ['雨', '虹'], ['時間', '動か'], ['鎖', '断ち切'], ['希望', '始まり'], ['未来', '作れる'], ['星空', '見上げ'], ['涙', '優しい'], ['涙', 'やさしい'], ['なみだ', 'やさしい'], ['なみだ', '優しい'], ['痛み', '受け止める'], ['よく', '耐え'], ['傷跡', '証'], ['心', '溶かし'], ['もう', '傷つけ'], ['半分', '背負う'], ['たくさん', '笑お'], ['世界', '優しい'], ['宝物', '輝い'], ['指輪', '守っ'], ['思い出', '作ろ'], ['安らかに', '眠れ'], ['大丈夫', '安心'], ['心配', 'ない'], ['私', '守る'], ['君を', '守る'], ['ゆっくり', '休ん'], ['怖い', 'ない'], ['穏やか', '眠り'], ['休', '安心']
            ];

            const isValidMessage = allowedKeywordPairs.some(pair => {
                return message.includes(pair[0]) && message.includes(pair[1]);
            });

            if (isValidMessage) {
                STATE.endingTriggered = true;
                triggerEnding(message, name);
            } else {
                errorEl.textContent = 'どうか、温かい言葉を贈ってあげてください。';
            }
        }
        
        function triggerEnding(userMessage, userName) {
            window.onbeforeunload = null;
            const overlay = document.getElementById('ending-overlay');
            overlay.style.pointerEvents = 'auto';
            overlay.style.opacity = '1';

            setTimeout(() => {
                document.body.innerHTML = '';
                // 背景スタイルをリセットして真っ白にする
                document.body.className = '';
                document.body.style.backgroundColor = '#fff';
                document.body.style.backgroundImage = 'none';
                document.body.style.color = '#333';
                document.body.style.display = 'flex';
                document.body.style.justifyContent = 'center';
                document.body.style.alignItems = 'center';
                document.body.style.height = '100vh';
                document.body.style.margin = '0';
                
                const finalMessageContainer = document.createElement('div');
                finalMessageContainer.style.textAlign = 'center';
                finalMessageContainer.style.fontFamily = "'MS Mincho', 'Hirino Mincho ProN', serif";
                finalMessageContainer.style.fontSize = '18px';
                finalMessageContainer.style.lineHeight = '2';
                finalMessageContainer.style.opacity = '0';
                finalMessageContainer.style.transition = 'opacity 2.5s ease-in';
                
                // ハンドルネームが入力されていれば「〇〇さん」、なければ「あなた」とする
                const handleName = userName ? userName.trim() : '';
                const viewerName = handleName ? `${handleName}さん` : 'あなた';
                
                finalMessageContainer.innerHTML = `
                    <p>ありがとう。</p>
                    <p>${viewerName}の「${userMessage}」という言葉、<br>ちゃんと届いたよ。</p>
                    <p>冷たくて暗いだけだと思っていたこの世界に、<br>小さな光が灯ったみたい。</p>
                    <p>これで、やっと安らかに眠れる。</p>
                    <p>私のホームページを見てくれたのが${viewerName}でよかった。</p>
                    <p>本当にごめんなさい。</p>
                    <p>そして、ありがとう。</p>
                    <br>
                    <p>- 湊 -</p>
                `;
                
                document.body.appendChild(finalMessageContainer);

                setTimeout(() => {
                    finalMessageContainer.style.opacity = '1';
                }, 500);

            }, 2500);
        }

        document.addEventListener('DOMContentLoaded', () => {
            
            window.onfocus = () => {
                if (curseSpreadClicked) {
                    curseSpreadClicked = false;
                    triggerBadEnd();
                }
            };

            // Photo Modal Logic
            const photoImages = document.querySelectorAll('.photo-item img');
            const modalOverlay = document.getElementById('modal-overlay');
            const modalImage = document.getElementById('modal-image');
            const closeButton = document.getElementById('close-button');

            if (modalOverlay && modalImage && closeButton) {
                photoImages.forEach(img => {
                    img.addEventListener('click', () => {
                        modalImage.src = img.src;
                        modalOverlay.style.display = 'flex';
                    });
                });

                const closeModal = () => {
                    modalOverlay.style.display = 'none';
                };

                closeButton.addEventListener('click', closeModal);
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        closeModal();
                    }
                });
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && modalOverlay.style.display === 'flex') {
                        closeModal();
                    }
                });
            }
        });
    </script>
</body>
</html>
